<div ng-controller="SiteCtrl as ctrl">
  <div class="row">
    <div class="col-sm-3" id="sidebar">

      <ul class="nav nav-stacked">
        <li>
          <input ng-model="ctrl.query" placeholder="Search"/>
        </li>
        <li>
            <p>Filter by project type</p>
            <select class="selectpicker" ng-model='ctrl.variable' ng-options=" feature.variable as feature.variable for feature in ctrl.projects | unique:'variable' | orderBy:'variable'" fix>
              <option value="" selected="selected">All types</option>
            </select>
        </li>
        <li>
            <p>Filter by year</p>
            <select class="selectpicker" ng-model='ctrl.year' ng-options=" feature.year as feature.year for feature in ctrl.projects | unique:'year' | orderBy:'year'" fix>
              <option value="" selected="selected">All years</option>
            </select>
        </li>
            <li>
              <div  class="form-group">
                <button type="button" class="btn btn-grey" ng-click='ctrl.clearSelections()'>Clear Selections</button>
              </div>
            </li>
      </ul>
    </div>
    <div class="col-sm-9" id="mainCol">
    <div ng-controller="MapCtrl as map" >
      <div style="height:300px;">
        <leaflet center="map.center" geojson="ctrl.geojson" events="map.events" width="100%" height="100%"></leaflet>
      </div>
    </div>

    <div style="padding: 20px"></div>

    <div ng-controller="TableCtrl as table">
          <table border="1" style="width:100%">
            <tr>
              <th><a href="" ng-click="orderByField = 'name'; reverse=!reverse">Name</a></th>
              <th><a href="" ng-click="orderByField = 'variable'; reverse=!reverse">Project Type</a></th>
              <th><a href="" ng-click="orderByField = 'year'; reverse=!reverse">Year</a></th>
            </tr>
            <tr ng-repeat="feature in ctrl.projects | orderBy:orderByField:reverse | customSearch:ctrl.variable:ctrl.year | filter:ctrl.query" ng-class="{'selected':$index == table.selectedRow}" ng-click="table.setClickedRow($index)">
              <td>{{feature.name}}</td>
              <td>{{feature.variable}}</td>
              <td>{{feature.year}}</td>
            </tr>
          </table>
        </div>
      </div>
    </div>
  </div>
