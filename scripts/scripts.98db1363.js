"use strict";angular.module("ngApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.bootstrap","ui-leaflet"]).config(["$locationProvider","$routeProvider",function(a,b){a.hashPrefix("!"),b.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl",controllerAs:"about"}).when("/details/:projectID",{templateUrl:"views/details.html",controller:"DetailsCtrl",controllerAs:"details"}).otherwise({redirectTo:"/"})}]);var app=angular.module("ngApp");app.controller("MainCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),app.controller("MapCtrl",function(){this.center={lat:38.276456,lng:-121.392615,zoom:12},this.defaults={scrollWheelZoom:!1},this.events=null}),app.controller("SiteCtrl",["$http","$scope","$filter","leafletData",function(a,b,c,d){function e(a,c){a=a.feature,b.SelectedFID=a.properties.FID;var d={radius:15,fillColor:"#FFFF98",color:"#FFFF7F",weight:5,opacity:1,fillOpacity:.7};c.target.setStyle(d)}function f(a,c){a=a.feature,b.SelectedFID=null,console.log(c);var d={radius:15,fillColor:"#3232FF",color:"#0000FF",weight:1,opacity:1,fillOpacity:.8};c.target.setStyle(d)}function g(a,c){console.log(a),c.target.bindPopup(b.popupMessage(a.feature.properties.id,a.feature.properties.name)),c.target.openPopup()}var h={radius:15,fillColor:"#3232FF",color:"#0000FF",weight:1,opacity:1,fillOpacity:.8};a.get("geo.geojson").success(function(a){angular.extend(b,{geojson:{data:a,pointToLayer:function(a,b){return L.circleMarker(b,h)}},ProjectGeo:{data:a,pointToLayer:function(a,b){return L.circleMarker(b,h)}}}),b.centerJSON()}),a.get("projects.json").then(function(a){b.projects=a.data}),this.clearSelections=function(){b.search.query="",b.search.variable="",b.search.year="",b.SelectedFID=null,b.selectedRow=null},b.setClickedRow=function(a){b.selectedRow=a,b.search.SelectedFeature=b.selectedRow.FID},b.$on("leafletDirectiveGeoJson.map.mouseover",function(a,b){e(b.leafletObject,b.leafletEvent)}),b.$on("leafletDirectiveGeoJson.map.mouseout",function(a,b){f(b.leafletObject,b.leafletEvent)}),b.popupMessage=function(a,b){var c='<a href="#!/details/'+a+'">'+b+"</a>";return c},b.$on("leafletDirectiveGeoJson.map.click",function(a,b){console.log("click"),g(b.leafletObject,b.leafletEvent)}),b.search={query:"",variable:"",year:""},b.$watchCollection("search",function(a,d){if(console.log("Search Values ",a),a!==d){for(var e=angular.copy(b.projects),f=c("filter")(e,b.search.query),g=c("customSearch")(f,b.search.variable,b.search.year),h=[],i=0;i<g.length;i++)h.push(g[i].FID);var j=angular.copy(b.ProjectGeo),k=c("filter")(j.data.features,function(a){for(var b=a.properties.FID,c=null,d=0;d<h.length;d++){if(b===h[d])return c=!0;if(c===!0)return a}});j.features=k,b.geojson.data=j,b.centerJSON()}}),b.centerJSON=function(){d.getMap("map").then(function(a){for(var c=[],d=0;d<b.geojson.data.features.length;d++){var e=b.geojson.data.features[d];if("Point"===e.geometry.type){var f=e.geometry.coordinates;c.push(L.GeoJSON.coordsToLatLng(f))}else if("MultiPoint"===e.geometry.type)for(var g=0;g<e.geometry.coordinates.length;g++){var f=e.geometry.coordinates[g];c.push(L.GeoJSON.coordsToLatLng(f))}else if("Polygon"===e.geometry.type){var h=e.geometry.coordinates[0];for(var i in h){var f=h[i];c.push(L.GeoJSON.coordsToLatLng(f))}}else console.log("Unknown feature geometry type. Try using points, multipoints, or polygons")}a.fitBounds(c)})}}]),app.filter("unique",["$parse",function(a){return function(b,c){if(c===!1)return b;if((c||angular.isUndefined(c))&&angular.isArray(b)){var d=[],e=angular.isString(c)?a(c):function(a){return a},f=function(a){return angular.isObject(a)?e(a):a};angular.forEach(b,function(a){for(var b=!1,c=0;c<d.length;c++)if(angular.equals(f(d[c]),f(a))){b=!0;break}b||d.push(a)}),b=d}return b}}]),app.filter("customSearch",[function(){return function(a,b,c){var d=[];if(b&&c)for(var e=0;e<a.length;e++)-1!==a[e].variable.indexOf(b)&&-1!==a[e].year.indexOf(c)&&d.push(a[e]);else if(b)for(var f=0;f<a.length;f++)-1!==a[f].variable.indexOf(b)&&d.push(a[f]);else if(c)for(var g=0;g<a.length;g++)-1!==a[g].year.indexOf(c)&&d.push(a[g]);else d=a;return d}}]),angular.module("ngApp").controller("AboutCtrl",function(){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}),angular.module("ngApp").controller("DetailsCtrl",["$http","$routeParams","$scope","leafletData",function(a,b,c,d){this.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"];var e=this;a.get("projects/"+b.projectID+".json").then(function(a){e.project=a.data});var f={radius:15,fillColor:"#3232FF",color:"#0000FF",weight:1,opacity:1,fillOpacity:.8};a.get("projects/"+b.projectID+".geojson").success(function(a){angular.extend(c,{geojson:{data:a,pointToLayer:function(a,b){return L.circleMarker(b,f)}}})}),this.activetab="metadata",c.centerJSON=function(){d.getMap("MyMap").then(function(a){for(var b=[],d=0;d<c.geojson.data.features.length;d++){var e=c.geojson.data.features[d];if("Point"===e.geometry.type){var f=e.geometry.coordinates;b.push(L.GeoJSON.coordsToLatLng(f))}else if("MultiPoint"===e.geometry.type)for(var g=0;g<e.geometry.coordinates.length;g++){var f=e.geometry.coordinates[g];b.push(L.GeoJSON.coordsToLatLng(f))}else if("Polygon"===e.geometry.type){var h=e.geometry.coordinates[0];for(var i in h){var f=h[i];b.push(L.GeoJSON.coordsToLatLng(f))}}else console.log("Unknown feature geometry type. Try using points, multipoints, or polygons")}a.fitBounds(b)})}}]),angular.module("ngApp").run(["$templateCache",function(a){a.put("views/about.html","<p>Data explorer for Consumnes Research Group III</p>"),a.put("views/details.html",'<div ng-controller="DetailsCtrl as details"> <h3>{{details.project.name}}</h3> <ul class="nav nav-tabs"> <li ng-class="{active:details.activetab === \'metadata\'}"><a ng-click="details.activetab = &quot;metadata&quot;">Metadata</a></li> <li ng-class="{active:details.activetab === \'location\'}"><a ng-click="details.activetab = &quot;location&quot;">Map</a></li> <li ng-class="{active:details.activetab === \'download\'}"><a ng-click="details.activetab = &quot;download&quot;">Download</a></li> </ul> <div class="tab-content" style="padding:10px"> <div ng-switch="details.activetab"> <div ng-switch-when="metadata"> <p><b>About:</b> {{details.project.details}}</p> <p><b>Contact:</b> {{details.project.contact}}</p> <p><b>Dates:</b> {{details.project.dates}}</p> <p><b>Variables:</b> <li ng-repeat="variable in details.project.variables"> {{variable}} </li> </p> </div> <div ng-switch-when="data"> or this</div> <div ng-switch-when="location"> <div style="height:300px"> <leaflet id="MyMap" geojson="geojson" height="100%" ng-init="centerJSON()"></leaflet> <input type="button" value="Click to Center" ng-click="centerJSON()"> </div> </div> <div ng-switch-when="download"> <ul> <li ng-repeat="download in details.project.downloads"> <a href="{{download.url}}" download> <span class="glyphicon glyphicon-download-alt" aria-hidden="true"></span> {{download.name}} </a> </li> </ul> </div> </div> </div> </div>'),a.put("views/main.html",'<div ng-controller="SiteCtrl as ctrl"> <div class="row"> <div class="col-sm-3" id="sidebar"> <ul class="nav nav-stacked"> <li> <input ng-model="search.query" placeholder="Search"> </li> <li> <p>Filter by project type</p> <select class="selectpicker" ng-model="search.variable" ng-options=" feature.variable as feature.variable for feature in projects | unique:\'variable\' | orderBy:\'variable\'" fix> <option value="" selected>All types</option> </select> </li> <li> <p>Filter by year</p> <select class="selectpicker" ng-model="search.year" ng-options=" feature.year as feature.year for feature in projects | unique:\'year\' | orderBy:\'year\'" fix> <option value="" selected>All years</option> </select> </li> <li> <div class="form-group"> <button type="button" class="btn btn-grey" ng-click="ctrl.clearSelections()"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span> Clear Selections</button> </div> </li> </ul> </div> <div class="col-sm-9" id="mainCol"> <div> <div style="height:300px"> <leaflet id="map" geojson="geojson" width="100%" height="100%" events="events" event-broadcast="events"></leaflet> </div> </div> <div style="padding: 20px"></div> <div> <table border="1" style="width:100%"> <tr> <th><a href="" ng-click="orderByField = \'name\'; reverse=!reverse">Name</a></th> <th><a href="" ng-click="orderByField = \'variable\'; reverse=!reverse">Project Type</a></th> <th><a href="" ng-click="orderByField = \'year\'; reverse=!reverse">Year</a></th> <th><a href="">More information</a></th> </tr> <tr ng-repeat="project in projects | orderBy:orderByField:reverse | customSearch:search.variable:search.year | filter:search.query" ng-class="{\'selected\':project.FID == SelectedFID}" ng-click="setClickedRow(project)"> <td>{{project.name}}</td> <td>{{project.variable}}</td> <td>{{project.year}}</td> <td> <a href="#!/details/{{project.id}}"><button type="button" class="btn btn-default btn-lg"> <span class="glyphicon glyphicon-info-sign" aria-hidden="true"></span> details </button></a> </td> </tr> </table> </div> </div> </div> </div>')}]);